<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📰 뉴스봇 설정</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <!-- 로딩 화면 -->
        <div id="loadingScreen" class="loading-screen">
            <div class="spinner"></div>
            <p>설정을 불러오는 중...</p>
        </div>

        <!-- 최초 설정 화면 -->
        <div id="setupScreen" class="screen" style="display: none;">
            <header class="header">
                <h1>📰 뉴스봇 설정</h1>
                <p class="subtitle">최초 설정을 진행해 주세요 (1회만)</p>
            </header>

            <section class="card setup-card">
                <h2>🔑 GitHub 연결</h2>
                <p class="description">
                    설정을 저장하려면 GitHub Personal Access Token이 필요합니다.<br>
                    토큰은 브라우저에만 저장되며 외부로 전송되지 않습니다.
                </p>

                <div class="form-group">
                    <label for="setupOwner">GitHub 사용자명</label>
                    <input type="text" id="setupOwner" placeholder="예: hong-gildong">
                </div>
                <div class="form-group">
                    <label for="setupRepo">레포지토리 이름</label>
                    <input type="text" id="setupRepo" placeholder="예: news_bot" value="news_bot">
                </div>
                <div class="form-group">
                    <label for="setupToken">Personal Access Token</label>
                    <input type="password" id="setupToken" placeholder="ghp_xxxxxxxxxxxx">
                </div>

                <button class="btn btn-primary btn-large" onclick="saveSetupAndConnect()">
                    연결 및 시작하기
                </button>

                <!-- 토큰 발급 가이드 -->
                <details class="guide-section">
                    <summary>📋 토큰 발급 방법 (클릭하여 펼치기)</summary>
                    <div class="guide-content">
                        <ol>
                            <li><a href="https://github.com/settings/tokens" target="_blank">GitHub 토큰 설정 페이지</a> 접속
                            </li>
                            <li><strong>Generate new token (classic)</strong> 클릭</li>
                            <li>Note: <code>뉴스봇 대시보드</code> 입력</li>
                            <li>Expiration: <code>No expiration</code> 선택 (권장)</li>
                            <li>권한: <strong>repo</strong> 체크 ✓</li>
                            <li><strong>Generate token</strong> 클릭</li>
                            <li>생성된 토큰(ghp_...)을 복사하여 위에 입력</li>
                        </ol>
                        <p class="warning">⚠️ 토큰은 한 번만 표시되므로 안전한 곳에 보관하세요!</p>
                    </div>
                </details>
            </section>
        </div>

        <!-- 메인 대시보드 화면 -->
        <div id="mainScreen" class="screen" style="display: none;">
            <header class="header">
                <div class="header-content">
                    <h1>📰 뉴스봇 설정</h1>
                    <p class="subtitle">키워드와 수신자를 관리하세요</p>
                </div>
                <div class="header-actions">
                    <span class="user-info" id="userInfo"></span>
                    <button class="btn btn-small btn-secondary" onclick="showSettings()">⚙️</button>
                </div>
            </header>

            <!-- 키워드 관리 섹션 -->
            <section class="card">
                <div class="card-header">
                    <h2>🏷️ 검색 키워드</h2>
                    <button class="btn btn-add" onclick="addKeyword()">+ 추가</button>
                </div>
                <div class="keywords-list" id="keywordsList"></div>
            </section>

            <!-- 수신자 관리 섹션 -->
            <section class="card">
                <div class="card-header">
                    <h2>📧 이메일 수신자</h2>
                    <button class="btn btn-add" onclick="addReceiver()">+ 추가</button>
                </div>
                <div class="receivers-list" id="receiversList"></div>
                <div class="info-box">
                    💡 GitHub Secrets의 EMAIL_RECEIVER와 이 목록의 수신자가 함께 사용됩니다.
                </div>
            </section>

            <!-- 고급 설정 섹션 -->
            <section class="card collapsed" id="advancedSection">
                <div class="card-header clickable" onclick="toggleAdvanced()">
                    <h2>⚙️ 고급 설정</h2>
                    <span class="collapse-icon">▼</span>
                </div>
                <div class="advanced-content">
                    <div class="settings-grid">
                        <div class="form-group">
                            <label>유사도 임계값</label>
                            <input type="number" id="similarityThreshold" min="0" max="1" step="0.1" value="0.5">
                            <small>중복 기사 판단 기준 (기본: 0.5)</small>
                        </div>
                        <div class="form-group">
                            <label>키워드당 최대 기사</label>
                            <input type="number" id="maxArticles" min="10" max="200" value="100">
                        </div>
                    </div>
                </div>
            </section>

            <!-- 저장 버튼 -->
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="downloadConfig()">📥 다운로드</button>
                <button class="btn btn-primary btn-large" onclick="saveToGitHub()" id="saveBtn">
                    💾 GitHub에 저장
                </button>
            </div>

            <div class="save-status" id="saveStatus"></div>
        </div>

        <!-- 설정 변경 모달 -->
        <div class="modal" id="settingsModal">
            <div class="modal-content">
                <h3>⚙️ 연결 설정</h3>
                <div class="form-group">
                    <label>GitHub 사용자명</label>
                    <input type="text" id="modalOwner">
                </div>
                <div class="form-group">
                    <label>레포지토리</label>
                    <input type="text" id="modalRepo">
                </div>
                <div class="form-group">
                    <label>토큰</label>
                    <input type="password" id="modalToken">
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeSettings()">취소</button>
                    <button class="btn btn-danger" onclick="resetSettings()">초기화</button>
                    <button class="btn btn-primary" onclick="updateSettings()">저장</button>
                </div>
            </div>
        </div>

        <!-- 색상 선택 모달 -->
        <div class="modal" id="colorModal">
            <div class="modal-content">
                <h3>🎨 색상 선택</h3>
                <div class="color-palette" id="colorPalette"></div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeColorModal()">취소</button>
                    <button class="btn btn-primary" onclick="applyColor()">적용</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>